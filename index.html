<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>OmniCare EIS · Main</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" />

<style>
html,body{ font-family:"Pretendard Variable", system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
.card{
  border:1px solid #e5e7eb; border-radius:16px; background:#fff;
  box-shadow:0 8px 24px rgba(15,23,42,.06);
}
.muted{ color:#64748b; }
.divider{ height:1px; background:#e5e7eb; }
.chip{ border:1px solid #e5e7eb; border-radius:999px; padding:.25rem .6rem; font-size:.8rem; color:#334155; background:#f8fafc; }
.btn2{ border:1px solid #e5e7eb; background:#fff; color:#0f172a; border-radius:12px; padding:.55rem .9rem; font-weight:700; }
.small{ font-size:.85rem; }

/* ===== 차트 (이미지 스타일 유사) ===== */
.chart-wrap{
  display:grid;
  grid-auto-flow: column;
  grid-auto-columns: 64px;   /* ← 막대 폭 (여기서 조절) */
  gap:12px;
  align-items:end;
  overflow-x:auto;
  padding-bottom:6px;
}

/* 스크롤바 예쁘게(선택) */
.chart-wrap::-webkit-scrollbar{ height:6px; }
.chart-wrap::-webkit-scrollbar-thumb{ background:#cbd5f5; border-radius:999px; }
.chart-wrap::-webkit-scrollbar-track{ background:#f1f5f9; }

.bar-col{ display:flex; flex-direction:column; align-items:center; gap:6px; }
.bar-area{
  position:relative; width:100%; height:250px;
  display:flex; align-items:flex-end;
}
.bar-goal{
  width:100%;
  background:#e5e7eb;
  border-radius:8px;
  position:absolute;
  bottom:0;
}
.bar-actual{
  width:56%;
  position:absolute;
  bottom:0;
  left:50%;
  transform:translateX(-50%);
  border-radius:6px;
}

/* KMI: 목표 회색 / 누계 진한(검정계열) */
.kmi-actual{ background:#0f172a; }

/* OmniCare: 목표 하늘색 / 누계 진한 남색 */
.omni-goal{ background:#bfdbfe; }
.omni-actual{ background:#1e3a8a; }

.top-num{ font-size:.75rem; color:#374151; font-weight:800; }
.mid-diff{ font-size:.75rem; font-weight:900; color:#dc2626; }
.bottom-num{ font-size:.75rem; color:#0f172a; font-weight:900; }
.bar-label{ font-size:.8rem; font-weight:800; color:#0f172a; text-align:center; }

/* ===== 뉴스 ===== */
.newsCard{
  border:1px solid #e5e7eb;
  border-radius:14px;
  padding:14px;
  background:#fff;
}
.newsItem{
  padding:10px 12px;
  border:1px solid #e5e7eb;
  border-radius:14px;
  background:#f8fafc;
}
.newsTitle{ font-weight:800; color:#0f172a; }
.newsMeta{ color:#64748b; font-size:.8rem; margin-top:2px; }
.newsLink{ color:#0f172a; text-decoration:none; }
.newsLink:hover{ text-decoration:underline; }

.kbBox{
  background:linear-gradient(180deg,#ffffff, #f8fafc);
  border:1px solid #e5e7eb;
  border-radius:16px;
  padding:16px;
}
.quote{
  font-size:1.05rem;
  font-weight:900;
  color:#0f172a;
  line-height:1.4;
}
</style>
</head>

<body class="bg-slate-50">

<header class="sticky top-0 z-20 bg-white/90 backdrop-blur border-b border-slate-200">
  <div class="max-w-[1440px] mx-auto px-2 py-3 flex items-center gap-3">
    <!-- ✅ 로고 클릭 시 메인으로 -->
    <a href="https://qkr3069-beep.github.io/EIS/" aria-label="메인으로 이동">
      <img src="omnicare_logo.png"
           alt="옴니케어 로고"
           class="h-12 object-contain cursor-pointer" />
    </a>
    <div class="flex-1">
      <div class="font-semibold text-slate-900">OmniCare Intelligence Hub</div>
      <div class="text-sm muted">매출 현황 · 대표 메시지 · 업계 소식</div>
    </div>

	<button onclick="location.href='admin_manager.html'" class="btn2">관리자 페이지</button>
	<button onclick="location.href='mypage_sales.html'" class="btn2">마이페이지</button>
  </div>
</header>

<main class="max-w-[1440px] mx-auto px-2 py-6 space-y-6">

  <!-- 1행: KMI + OmniCare (같은 행) -->
  <section class="grid grid-cols-1 lg:grid-cols-2 gap-4">
    <!-- KMI -->
    <div class="card p-5">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="font-extrabold text-slate-900 text-lg">KMI 검진 누계 매출</div>
          <div class="muted small">목표(회색) 대비 누계(진한색) · 전체 지점 한 차트</div>
        </div>
        <span class="chip">단위: 백만원</span>
      </div>

      <div class="chart-wrap" id="kmiChart"></div>
    </div>

    <!-- OmniCare -->
    <div class="card p-5">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="font-extrabold text-slate-900 text-lg">옴니케어 누계 매출</div>
          <div class="muted small">2025 예상(하늘색) 대비 누계(남색) · 사업부 한 차트</div>
        </div>
        <span class="chip">단위: 백만원</span>
      </div>

      <div class="chart-wrap" id="omniChart"></div>
    </div>
  </section>

  <!-- 2행: 국보급 이야기(대표님 한 말씀) -->
  <section class="card p-6">
    <div class="flex items-start justify-between gap-3">
      <div>
        <div class="font-extrabold text-slate-900 text-lg">국보급 이야기</div>
        <div class="muted small">대표님 한 말씀</div>
      </div>
      <span class="chip">MESSAGE</span>
    </div>

    <div class="divider my-4"></div>

    <div class="kbBox">
      <div class="quote" id="ceoQuote">“숫자는 과거를 말하고, 실행은 내일을 만든다.”</div>
      <div class="mt-3 text-slate-900 leading-relaxed" id="ceoBody"></div>
      <div class="mt-4 muted small font-semibold" id="ceoSign">— 대표</div>
    </div>
  </section>

  <!-- Industry News -->
  <section class="card p-4">
    <div class="mb-3 flex items-start justify-between gap-4">
      <div>
        <div class="font-semibold text-slate-900">업계 소식 브리핑</div>
        <div class="muted small">주요 카테고리별 핵심 이슈 (각 3건 · 자동 불러오기)</div>
      </div>

      <!-- 더보기 -->
      <a href="news.html"
         class="text-sm font-semibold text-slate-700 hover:text-slate-900 transition flex items-center gap-1">
        더보기
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
             fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </div>

    <div class="divider mb-4"></div>

    <!-- ⭐ 국보급 소식 (대표님 추천 기사) -->
    <div class="mb-4 p-5 rounded-2xl border border-slate-200 bg-white">
      <div class="flex items-center justify-between mb-3">
        <div class="font-extrabold text-slate-900">
          국보급 소식 <span class="muted text-sm font-semibold">· 대표님 추천</span>
        </div>
        <span class="chip">EDITOR’S PICK</span>
      </div>

      <!-- JS가 채우는 영역 -->
      <div id="executiveNews" class="grid grid-cols-1 md:grid-cols-3 gap-3"></div>
    </div>

    <!-- 2x2 Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <!-- 건강검진 -->
      <div class="p-4 rounded-2xl border border-slate-200 bg-slate-50">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">건강검진</div>
          <span class="chip">TREND</span>
        </div>
        <!-- ✅ JS가 여기 채움 -->
        <ul id="industry-healthcheck" class="space-y-2 text-sm"></ul>
      </div>

      <!-- 검진센터 -->
      <div class="p-4 rounded-2xl border border-slate-200 bg-slate-50">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">검진센터</div>
          <span class="chip">CENTER</span>
        </div>
        <!-- ✅ JS가 여기 채움 -->
        <ul id="industry-center" class="space-y-2 text-sm"></ul>
      </div>

      <!-- 경쟁사 -->
      <div class="p-4 rounded-2xl border border-slate-200 bg-slate-50">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">경쟁사</div>
          <span class="chip">COMPETITOR</span>
        </div>
        <!-- ✅ JS가 여기 채움 -->
        <ul id="industry-competitor" class="space-y-2 text-sm"></ul>
      </div>

      <!-- 헬스케어 -->
      <div class="p-4 rounded-2xl border border-slate-200 bg-slate-50">
        <div class="flex items-center justify-between mb-2">
          <div class="font-semibold">헬스케어</div>
          <span class="chip">HEALTHCARE</span>
        </div>
        <!-- ✅ JS가 여기 채움 -->
        <ul id="industry-healthcare" class="space-y-2 text-sm"></ul>
      </div>

    </div>
  </section>

  <footer class="text-center muted small py-6">
    샘플 화면입니다. 실제 서비스에서는 DB/권한/감사로그/매출 집계/뉴스 수집이 추가됩니다.
  </footer>
</main>

<script>
/* ================= 권한/유저(샘플) =================
   role 예시: "sales" | "manager" | "ceo"
   - manager/ceo: 관리자 페이지 버튼 노출
*/
const CURRENT_USER = { id:"u1", name:"김영업", team:"A팀", role:"sales" };

function goMyPage(){
  if (CURRENT_USER.role === "sales") return location.href = "mypage_sales.html";
  if (CURRENT_USER.role === "manager") return location.href = "mypage_manager.html";
  return location.href = "mypage_ceo.html";
}

function goAdminPage(){
  if (["manager","ceo"].includes(CURRENT_USER.role)) {
    return location.href = "admin_manager.html"; // ✅ 새로 만들 관리자 페이지 파일명
  }
  alert("관리자 권한이 없습니다.");
}

/* ✅ 관리자 버튼 노출 제어 */
(function initHeaderAuth(){
  const btn = document.getElementById("adminBtn");
  if (!btn) return;
  if (["manager","ceo"].includes(CURRENT_USER.role)) btn.classList.remove("hidden");
})();

/* ================== 데이터(샘플) ================== */
/* 단위: 백만원 */
const KMI = [
  { name:"광화문", goal:53000, actual:12141, diff:+2567 },
  { name:"여의도", goal:63900, actual:15262, diff:+972 },
  { name:"강남",   goal:68700, actual:17489, diff:+1562 },
  { name:"수원",   goal:66300, actual:17845, diff:+2202 },
  { name:"대구",   goal:46650, actual:12000, diff:+463 },
  { name:"부산",   goal:47100, actual:12222, diff:+481 },
  { name:"광주",   goal:41750, actual:11684, diff:+1176 },
  { name:"제주",   goal:9600,  actual:2260,  diff:+807 },
  { name:"수도권출장", goal:3000, actual:1066, diff:-88 },
];

const OMNI = [
  { name:"1본부", goal:80000, actual:42000, diff:+980 },
  { name:"2본부", goal:70000, actual:38000, diff:+620 },
  { name:"수원",  goal:40000, actual:26000, diff:+310 },
  { name:"대구",  goal:45000, actual:29000, diff:+450 },
  { name:"부산",  goal:42000, actual:28000, diff:+220 },
  { name:"광주",  goal:30000, actual:19000, diff:+180 },
  { name:"제휴",  goal:35000, actual:22000, diff:+210 },
];

const CEO = {
  quote: "“숫자는 과거를 말하고, 실행은 내일을 만든다.”",
  body: [
    "오늘은 누계보다 속도를 봅시다.",
    "우리가 이기는 포인트는 ‘단가’가 아니라 ‘운영 편의성’과 ‘전환 정밀도’입니다.",
    "각 조직은 상위 3개 레버(리드→미팅→계약, 정산, 재구매)를 ‘매주 하나’만 개선해도 누계는 자연히 따라옵니다."
  ],
  sign: "— 대표"
};

/* ================== 렌더: 차트(이미지 스타일) ================== */
function renderOverlayBarChart(data, wrapId, mode){
  const wrap = document.getElementById(wrapId);
  wrap.innerHTML = "";
  const maxGoal = Math.max(...data.map(d=>d.goal||0), 1);

  data.forEach(d=>{
    const goalH = (d.goal/maxGoal)*100;
    const actualH = (d.actual/maxGoal)*100;

    const col = document.createElement("div");
    col.className = "bar-col";

    const goalClass = (mode==="omni") ? "bar-goal omni-goal" : "bar-goal";
    const actualClass = (mode==="omni") ? "bar-actual omni-actual" : "bar-actual kmi-actual";

    col.innerHTML = `
      <div class="top-num">${d.goal.toLocaleString()}</div>

      <div class="bar-area">
        <div class="${goalClass}" style="height:${goalH}%"></div>
        <div class="${actualClass}" style="height:${actualH}%"></div>
      </div>

      <div class="mid-diff">${d.diff>=0?'+':''}${d.diff.toLocaleString()}</div>
      <div class="bottom-num">${d.actual.toLocaleString()}</div>
      <div class="bar-label">${d.name}</div>
    `;
    wrap.appendChild(col);
  });
}

/* ================== 렌더: 대표 메시지 ================== */
function renderCEO(){
  document.getElementById("ceoQuote").textContent = CEO.quote;
  document.getElementById("ceoBody").innerHTML = CEO.body.map(p=>`<p class="mt-2">${p}</p>`).join("");
  document.getElementById("ceoSign").textContent = CEO.sign;
}

/* ================== ✅ 업계소식: RSS 불러오기(메인용) ================== */
/* ✅ 국보급 소식(대표님 추천) + 주요 4카테고리(각 3건 · 자동 불러오기) */
const INDUSTRY_FEEDS = [
  {
    key: "executive",
    category: "국보급 소식 (대표님 추천 기사)",
    tag: "EDITOR’S PICK",
    targetUlId: "executiveNews",  // ✅ 여기 실제 DOM id에 맞춤
    rss: "https://news.google.com/rss/search?q=(%EA%B1%B4%EA%B0%95%EA%B2%80%EC%A7%84+OR+%EC%A2%85%ED%95%A9%EA%B2%80%EC%A7%84+OR+KMI+OR+%ED%94%8C%EB%9E%AB%ED%8F%BC+OR+%EB%94%94%EC%A7%80%ED%84%B8%ED%97%AC%EC%8A%A4+OR+%ED%97%AC%EC%8A%A4%EC%BC%80%EC%96%B4+OR+GC%EC%BC%80%EC%96%B4)%20(%EC%A0%95%EC%B1%85+OR+%EC%98%88%EC%82%B0+OR+%EA%B2%BD%EC%9F%81+OR+%EC%8A%A4%EC%BC%80%EC%A4%84+OR+%EC%A0%95%EC%82%B0+OR+%EB%A6%AC%ED%8F%AC%ED%8A%B8)&hl=ko&gl=KR&ceid=KR:ko"
  },

  {
    key: "healthcheck",
    category: "건강검진",
    tag: "TREND",
    targetUlId: "industry-healthcheck",
    rss: "https://news.google.com/rss/search?q=건강검진+OR+종합검진+OR+암검진+OR+대장내시경&hl=ko&gl=KR&ceid=KR:ko"
  },
  {
    key: "center",
    category: "검진센터",
    tag: "CENTER",
    targetUlId: "industry-center",
    rss: "https://news.google.com/rss/search?q=KMI+OR+%22%ED%95%9C%EA%B5%AD%EC%9D%98%ED%95%99%EC%97%B0%EA%B5%AC%EC%86%8C%22+OR+%22%EA%B1%B4%EA%B0%95%EA%B4%80%EB%A6%AC%ED%98%91%ED%9A%8C%22+OR+%22%ED%95%98%EB%82%98%EB%A1%9C%EC%9D%98%EB%A3%8C%EC%9E%AC%EB%8B%A8%22&hl=ko&gl=KR&ceid=KR:ko"
  },
  {
    key: "competitor",
    category: "경쟁사",
    tag: "COMPETITOR",
    targetUlId: "industry-competitor",
    rss: "https://news.google.com/rss/search?q=GC%EC%BC%80%EC%96%B4+OR+%EC%B9%B4%EC%B9%B4%EC%98%A4%ED%97%AC%EC%8A%A4%EC%BC%80%EC%96%B4+OR+%EC%9C%A0%EB%B9%84%EC%BC%80%EC%96%B4+OR+%EB%A0%88%EB%AA%AC%ED%97%AC%EC%8A%A4%EC%BC%80%EC%96%B4+OR+%EC%BC%80%EC%96%B4%EB%9E%A9%EC%8A%A4&hl=ko&gl=KR&ceid=KR:ko"
  },
  {
    key: "healthcare",
    category: "헬스케어",
    tag: "HEALTHCARE",
    targetUlId: "industry-healthcare",
    rss: "https://news.google.com/rss/search?q=%ED%97%AC%EC%8A%A4%EC%BC%80%EC%96%B4+OR+%EB%94%94%EC%A7%80%ED%84%B8%ED%97%AC%EC%8A%A4+OR+AI+%EA%B1%B4%EA%B0%95+OR+%EC%9B%A8%EC%96%B4%EB%9F%AC%EB%B8%94+%EA%B1%B4%EA%B0%95&hl=ko&gl=KR&ceid=KR:ko"
  }
];

async function fetchRSS2JSON(rssUrl){
  const r = await fetch("https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(rssUrl));
  return r.json();
}
function stripHtml(s){
  return (s || "").replace(/<[^>]*>/g, " ").replace(/\s+/g, " ").trim();
}
function toYMD(dateStr){
  const d = new Date(dateStr);
  if (Number.isNaN(d.getTime())) return "";
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${dd}`;
}

/* ✅ UL/GRID 공통 렌더 */
function renderNewsIntoTarget(targetId, items, fallbackMsg){
  const el = document.getElementById(targetId);
  if (!el) return;

  el.innerHTML = "";

  if (!items || items.length === 0){
    const div = document.createElement("div");
    div.className = "text-slate-500 text-sm";
    div.textContent = fallbackMsg || "표시할 소식이 없습니다.";
    el.appendChild(div);
    return;
  }

  // executiveNews는 div grid, 나머지는 ul list지만 동일하게 li로 넣어도 브라우저가 렌더함.
  // 깔끔하게: executive는 카드형, 나머지는 기존 newsItem 유지
  if (targetId === "executiveNews"){
    items.slice(0,3).forEach(it=>{
      const box = document.createElement("div");
      box.className = "newsItem";
      box.innerHTML = `
        <a class="newsLink newsTitle" href="${it.link}" target="_blank" rel="noopener">${it.title}</a>
        <div class="newsMeta">${it.date || "-"} · ${it.summary}</div>
      `;
      el.appendChild(box);
    });
    return;
  }

  // 나머지는 UL로 렌더
  items.slice(0,3).forEach(it=>{
    const li = document.createElement("li");
    li.className = "newsItem";
    li.innerHTML = `
      <a class="newsLink newsTitle" href="${it.link}" target="_blank" rel="noopener">${it.title}</a>
      <div class="newsMeta">${it.date || "-"} · ${it.summary}</div>
    `;
    el.appendChild(li);
  });
}

async function loadIndustryNewsToMain(){
  // 로딩 표시
  INDUSTRY_FEEDS.forEach(cfg=>{
    renderNewsIntoTarget(cfg.targetUlId, [], "불러오는 중…");
  });

  const blocks = await Promise.all(
    INDUSTRY_FEEDS.map(async (cfg) => {
      try{
        const data = await fetchRSS2JSON(cfg.rss);
        const limit = (cfg.key === "executive") ? 5 : 3;

        const items = (data.items || [])
          .slice(0, limit)
          .map(it => {
            const desc = stripHtml(it.description);
            return {
              title: it.title,
              date: toYMD(it.pubDate),
              summary: desc.slice(0, 70) + (desc.length > 70 ? "..." : ""),
              link: it.link
            };
          });

        return { ...cfg, items };
      }catch(e){
        return { ...cfg, items: [], error: true };
      }
    })
  );

  blocks.forEach(b=>{
    if (b.error){
      renderNewsIntoTarget(b.targetUlId, [], "불러오기에 실패했습니다. (네트워크/쿼터 이슈 가능)");
      return;
    }
    renderNewsIntoTarget(b.targetUlId, b.items, "해당 카테고리 소식 없음");
  });
}

/* ================== 초기 렌더 ================== */
renderOverlayBarChart(KMI, "kmiChart", "kmi");
renderOverlayBarChart(OMNI, "omniChart", "omni");
renderCEO();
loadIndustryNewsToMain();
</script>
</body>
</html>
