<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>옴니케어 뉴스 브리핑</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" />
  <style>
    html,body{ font-family:"Pretendard Variable", Pretendard, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .card { border:1px solid #e5e7eb; border-radius:16px; background:#fff; box-shadow:0 8px 24px rgba(15,23,42,.06); }
    .chip { border:1px solid #e5e7eb; border-radius:999px; padding:.25rem .6rem; font-size:.8rem; color:#334155; background:#f8fafc; }
    .muted{ color:#64748b; }
    .btn { border:1px solid #e5e7eb; background:#0f172a; color:#fff; border-radius:12px; padding:.55rem .9rem; font-weight:700; }
    .btn2 { border:1px solid #e5e7eb; background:#fff; color:#0f172a; border-radius:12px; padding:.55rem .9rem; font-weight:700; }
    .divider{ height:1px; background:#e5e7eb; }
    .small { font-size:.85rem; }
    input[type="date"]{ color:#0f172a; }
    .news-link{ color:#0f172a; font-weight:800; }
    .news-link:hover{ text-decoration:underline; }
  </style>
</head>

<body class="bg-slate-50 text-slate-900 min-h-screen">

  <!-- Header (메인 톤과 동일) -->
  <header class="sticky top-0 z-20 bg-white/90 backdrop-blur border-b border-slate-200">
    <div class="max-w-[1440px] mx-auto px-2 py-3 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
      <div class="flex items-center gap-3">
        <!-- 로고 클릭 시 메인으로 이동 -->
        <a href="https://qkr3069-beep.github.io/EIS/" aria-label="메인으로 이동" class="shrink-0">
          <img src="omnicare_logo.png"
               alt="옴니케어 로고"
               class="h-12 md:h-14 object-contain cursor-pointer" />
        </a>

        <div>
          <div class="font-semibold text-slate-900">OmniCare News Briefing</div>
          <div class="text-sm muted">업계/경쟁/센터/헬스케어 소식을 한 화면에</div>
        </div>
      </div>

      <div class="flex items-center gap-2 flex-wrap justify-end">
        <a href="https://www.korea.kr/" target="_blank" rel="noopener" class="btn2 text-sm">
          정책브리핑
        </a>

        <div class="flex items-center gap-2">
          <input type="date" id="datePicker" class="border border-slate-200 rounded-xl px-3 py-2 bg-white" />
          <button onclick="loadAllNews()" class="btn">조회</button>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-[1440px] mx-auto px-2 py-6 space-y-6">
    <div class="card p-4">
      <div class="flex items-start justify-between gap-4 flex-wrap">
        <div>
          <div class="font-semibold text-slate-900">오늘의 브리핑</div>
          <div class="muted small">선택한 날짜 기준(±1일) 최신 기사 5건씩 노출</div>
        </div>
        <div class="chip">SOURCE: Google News RSS</div>
      </div>
      <div class="divider my-3"></div>
      <div id="news-container" class="space-y-5"></div>
    </div>

    <footer class="text-center muted small py-6">
      샘플 화면입니다. 실제 서비스에서는 사내 크롤러/권한/저장소를 연동하는 것을 권장합니다.
    </footer>
  </main>

<script>
const feeds = {
  "건강검진": "https://news.google.com/rss/search?q=건강검진&hl=ko&gl=KR&ceid=KR:ko",
  "검진센터 소식": "https://news.google.com/rss/search?q=KMI+OR+한국의학연구소+OR+건강관리협회+OR+하나로의료재단+OR+메디플러스+OR+메디피아+OR+SCL+OR+세종365의원+OR+대청병원+OR+천안우리병원&hl=ko&gl=KR&ceid=KR:ko",
  "경쟁사 소식": "https://news.google.com/rss/search?q=GC케어+OR+어떠케어+OR+에임매드+OR+착한의사+OR+비바이노베이션+OR+케어링크+OR+케어랩스+OR+레몬헬스케어+OR+유비케어+OR+살루스케어+OR+카카오헬스케어&hl=ko&gl=KR&ceid=KR:ko",
  "헬스케어": "https://news.google.com/rss/search?q=헬스케어&hl=ko&gl=KR&ceid=KR:ko",
  "웰니스": "https://news.google.com/rss/search?q=웰니스&hl=ko&gl=KR&ceid=KR:ko",
  "웨어러블": "https://news.google.com/rss/search?q=갤럭시워치+OR+애플워치+OR+스마트워치+OR+핏빗+OR+워치&hl=ko&gl=KR&ceid=KR:ko",
  "주요 소식(국내)": "https://news.google.com/rss?hl=ko&gl=KR&ceid=KR:ko",
  "주요 소식(국외)": "https://news.google.com/rss?hl=en-US&gl=US&ceid=US:en"
};

const CATEGORY_KEYWORDS = {
  "건강검진": ["건강검진","종합검진","대장내시경","암검진"],
  "검진센터 소식": ["KMI","한국의학연구소","건강관리협회","하나로의료재단","메디플러스","메디피아","SCL","세종365의원","대청병원","천안우리병원"],
  "경쟁사 소식": ["GC케어","어떠케어","에임매드","착한의사","비바이노베이션","케어링크","케어랩스","레몬헬스케어","유비케어","살루스케어","카카오헬스케어"],
  "헬스케어": ["헬스케어","디지털헬스","원격의료"],
  "웰니스": ["웰니스","비만","영양관리","운동습관"],
  "웨어러블": ["갤럭시워치","애플워치","스마트워치","핏빗","웨어러블기기"]
};

const TOP_PAGE = {
  "주요 소식(국내)": "https://news.google.com/topstories?hl=ko&gl=KR&ceid=KR:ko",
  "주요 소식(국외)": "https://news.google.com/topstories?hl=en-US&gl=US&ceid=US:en"
};

function buildMoreLink(cat){
  if (TOP_PAGE[cat]) return TOP_PAGE[cat];
  const terms = CATEGORY_KEYWORDS[cat];
  if (!terms) return "#";
  const q = terms.map(t=>`%22${encodeURIComponent(t)}%22`).join("%20OR%20");
  return `https://news.google.com/search?q=${q}&hl=ko&gl=KR&ceid=KR%3Ako`;
}

function parseYMD(v){const[a,b,c]=v.split("-").map(Number);return new Date(a,b-1,c);}
function isSameDate(dt,sel){ return Math.abs((new Date(dt)-parseYMD(sel))/86400000)<=1; }

async function fetchRSS(u){
  const r = await fetch("https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(u));
  return r.json();
}

function renderSection(wrap,cat,items,selDate){
  let num = 0;

  const sec = document.createElement("section");
  sec.className = "card p-4";

  sec.innerHTML = `
    <div class="flex items-center justify-between gap-3 flex-wrap">
      <div class="flex items-center gap-2">
        <div class="font-semibold text-slate-900">${cat}</div>
        <span class="chip">TOP 5</span>
      </div>
      <a href="${buildMoreLink(cat)}" target="_blank" rel="noopener"
         class="btn2 text-sm">더보기</a>
    </div>
    <div class="divider my-3"></div>
    <div class="space-y-3" data-items></div>
    <div class="mt-3 muted small" data-empty style="display:none;">해당 날짜 소식 없음</div>
  `;

  const listWrap = sec.querySelector("[data-items]");
  const emptyEl = sec.querySelector("[data-empty]");

  for(const it of (items || [])){
    if(num >= 5) break;
    if(!isSameDate(it.pubDate, selDate)) continue;

    const clean = (it.description || "")
      .replace(/<[^>]+>/g, " ")
      .replace(/\s+/g, " ")
      .trim()
      .slice(0, 90);

    const row = document.createElement("div");
    row.className = "p-3 rounded-2xl bg-slate-50 border border-slate-200";

    row.innerHTML = `
      <a class="news-link block" href="${it.link}" target="_blank" rel="noopener">${it.title}</a>
      <div class="muted small mt-1">${clean ? clean + "…" : ""}</div>
    `;

    listWrap.appendChild(row);
    num++;
  }

  if(num === 0){
    emptyEl.style.display = "";
  }

  wrap.appendChild(sec);
}

async function loadAllNews(){
  const selDate = document.getElementById("datePicker").value;
  const c = document.getElementById("news-container");
  c.innerHTML = "";

  for(const [cat, url] of Object.entries(feeds)){
    try{
      const d = await fetchRSS(url);
      renderSection(c, cat, d.items, selDate);
    }catch(e){
      // 실패해도 섹션은 만들어 두기
      renderSection(c, cat, [], selDate);
    }
  }
}

window.onload = () => {
  document.getElementById("datePicker").value = new Date().toISOString().slice(0,10);
  loadAllNews();
};
</script>
</body>
</html>
